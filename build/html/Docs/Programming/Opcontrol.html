

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Field Oriented Control &mdash; HolonomicLib 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Autonomous Translation" href="AutonTranslate.html" />
    <link rel="prev" title="Setting Things Up" href="Setup.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> HolonomicLib
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Intro/GettingStarted.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Programming</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Setup.html">Setting Things Up</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Field Oriented Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="AutonTranslate.html">Autonomous Translation</a></li>
<li class="toctree-l1"><a class="reference internal" href="AutonPathing.html">Autonomous Path Following</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Explanation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Explanation/FieldOrientedControl.html">Explanation: Field Oriented Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Explanation/AutonMovement.html">Explanation: Holonomic Translation &amp; Path Following</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">HolonomicLib</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Field Oriented Control</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/Docs/Programming/Opcontrol.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="field-oriented-control">
<h1>Field Oriented Control<a class="headerlink" href="#field-oriented-control" title="Permalink to this headline">¶</a></h1>
<p>Out of the numerous reasons why holonomic drivetrains are superior to traditional tank drives,
one key reason is that field oriented control is possible. For those that do not know what
field oriented control is, you can take a look at this <a class="reference external" href="https://www.youtube.com/watch?v=50ZRrYFWPIc">video</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Okapi must be version 4.5.0 or higher for this to work.</p>
</div>
<p>To use Okapi’s <code class="docutils literal notranslate"><span class="pre">fieldOrientedXArcade</span></code>, you must cast <code class="docutils literal notranslate"><span class="pre">chassis</span></code> to an <code class="docutils literal notranslate"><span class="pre">XDriveModel</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">XDriveModel</span><span class="o">&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">static_pointer_cast</span><span class="o">&lt;</span><span class="n">XDriveModel</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">chassis</span><span class="o">-&gt;</span><span class="n">getModel</span><span class="p">());</span>
</pre></div>
</div>
<p>Next, use a controller and the <code class="docutils literal notranslate"><span class="pre">fieldOrientedXArcade</span></code> method to move the chassis.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kt">void</span> <span class="nf">opcontrol</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos"> 2</span>    <span class="n">Controller</span> <span class="n">controller</span> <span class="o">=</span> <span class="n">Controller</span><span class="p">();</span>
<span class="linenos"> 3</span>    <span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos"> 4</span>        <span class="n">model</span><span class="o">-&gt;</span><span class="n">fieldOrientedXArcade</span><span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">getAnalog</span><span class="p">(</span><span class="n">ControllerAnalog</span><span class="o">::</span><span class="n">leftY</span><span class="p">),</span>
<span class="linenos"> 5</span>                                    <span class="n">master</span><span class="p">.</span><span class="n">getAnalog</span><span class="p">(</span><span class="n">ControllerAnalog</span><span class="o">::</span><span class="n">leftX</span><span class="p">),</span>
<span class="linenos"> 6</span>                                    <span class="n">master</span><span class="p">.</span><span class="n">getAnalog</span><span class="p">(</span><span class="n">ControllerAnalog</span><span class="o">::</span><span class="n">rightX</span><span class="p">),</span>
<span class="linenos"> 7</span>                                    <span class="c1">// you can use an IMU as an alternative</span>
<span class="linenos"> 8</span>                                    <span class="n">controller</span><span class="o">-&gt;</span><span class="n">getPose</span><span class="p">().</span><span class="n">theta</span><span class="p">.</span><span class="n">convert</span><span class="p">(</span><span class="n">degree</span><span class="p">),</span>
<span class="linenos"> 9</span>                                    <span class="mf">0.05</span><span class="p">);</span>
<span class="linenos">10</span>
<span class="linenos">11</span>        <span class="n">pros</span><span class="o">::</span><span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="linenos">12</span>    <span class="p">}</span>
<span class="linenos">13</span><span class="p">}</span>
</pre></div>
</div>
<p>Here is a complete example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cm">/** Create Okapi OdomChassisController */</span>
<span class="linenos"> 2</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">OdomChassisController</span><span class="o">&gt;</span> <span class="n">chassis</span> <span class="o">=</span> <span class="n">ChassisControllerBuilder</span><span class="p">()</span>
<span class="linenos"> 3</span>    <span class="p">.</span><span class="n">withMotors</span><span class="p">(</span>
<span class="linenos"> 4</span>        <span class="mi">1</span><span class="p">,</span>  <span class="c1">// Top left</span>
<span class="linenos"> 5</span>        <span class="mi">-2</span><span class="p">,</span> <span class="c1">// Top right (reversed)</span>
<span class="linenos"> 6</span>        <span class="mi">-3</span><span class="p">,</span> <span class="c1">// Bottom right (reversed)</span>
<span class="linenos"> 7</span>        <span class="mi">4</span>   <span class="c1">// Bottom left</span>
<span class="linenos"> 8</span>    <span class="p">)</span>
<span class="linenos"> 9</span>    <span class="p">.</span><span class="n">withSensors</span><span class="p">(</span>
<span class="linenos">10</span>        <span class="n">ADIEncoder</span><span class="p">{</span><span class="sc">&#39;A&#39;</span><span class="p">,</span> <span class="sc">&#39;B&#39;</span><span class="p">},</span> <span class="c1">// left encoder in ADI ports A &amp; B</span>
<span class="linenos">11</span>        <span class="n">ADIEncoder</span><span class="p">{</span><span class="sc">&#39;C&#39;</span><span class="p">,</span> <span class="sc">&#39;D&#39;</span><span class="p">,</span> <span class="nb">true</span><span class="p">},</span>  <span class="c1">// right encoder in ADI ports C &amp; D (reversed)</span>
<span class="linenos">12</span>        <span class="n">ADIEncoder</span><span class="p">{</span><span class="sc">&#39;E&#39;</span><span class="p">,</span> <span class="sc">&#39;F&#39;</span><span class="p">}</span>  <span class="c1">// middle encoder in ADI ports E &amp; F</span>
<span class="linenos">13</span>    <span class="p">)</span>
<span class="linenos">14</span>    <span class="c1">// specify the tracking wheels diameter (2.75 in), track (7 in), and TPR (360)</span>
<span class="linenos">15</span>    <span class="c1">// specify the middle encoder distance (1 in) and diameter (2.75 in)</span>
<span class="linenos">16</span>    <span class="p">.</span><span class="n">withOdometry</span><span class="p">({{</span><span class="mf">2.75</span><span class="n">_in</span><span class="p">,</span> <span class="mi">7</span><span class="n">_in</span><span class="p">,</span> <span class="mi">1</span><span class="n">_in</span><span class="p">,</span> <span class="mf">2.75</span><span class="n">_in</span><span class="p">},</span> <span class="n">quadEncoderTPR</span><span class="p">})</span>
<span class="linenos">17</span>    <span class="p">.</span><span class="n">buildOdometry</span><span class="p">();</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="cm">/** Cast OdomChassisController model to XDriveModel */</span>
<span class="linenos">20</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">XDriveModel</span><span class="o">&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">static_pointer_cast</span><span class="o">&lt;</span><span class="n">XDriveModel</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">chassis</span><span class="o">-&gt;</span><span class="n">getModel</span><span class="p">());</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="cm">/** Opcontrol: uses field oriented control to control the chassis */</span>
<span class="linenos">23</span><span class="kt">void</span> <span class="nf">opcontrol</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos">24</span>
<span class="linenos">25</span>    <span class="n">Controller</span> <span class="n">controller</span> <span class="o">=</span> <span class="n">Controller</span><span class="p">();</span>
<span class="linenos">26</span>    <span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">27</span>        <span class="n">model</span><span class="o">-&gt;</span><span class="n">fieldOrientedXArcade</span><span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">getAnalog</span><span class="p">(</span><span class="n">ControllerAnalog</span><span class="o">::</span><span class="n">leftY</span><span class="p">),</span>
<span class="linenos">28</span>                                    <span class="n">master</span><span class="p">.</span><span class="n">getAnalog</span><span class="p">(</span><span class="n">ControllerAnalog</span><span class="o">::</span><span class="n">leftX</span><span class="p">),</span>
<span class="linenos">29</span>                                    <span class="n">master</span><span class="p">.</span><span class="n">getAnalog</span><span class="p">(</span><span class="n">ControllerAnalog</span><span class="o">::</span><span class="n">rightX</span><span class="p">),</span>
<span class="linenos">30</span>                                    <span class="c1">// you can use an IMU as an alternative</span>
<span class="linenos">31</span>                                    <span class="n">controller</span><span class="o">-&gt;</span><span class="n">getPose</span><span class="p">().</span><span class="n">theta</span><span class="p">.</span><span class="n">convert</span><span class="p">(</span><span class="n">degree</span><span class="p">),</span>
<span class="linenos">32</span>                                    <span class="mf">0.05</span><span class="p">);</span>
<span class="linenos">33</span>
<span class="linenos">34</span>        <span class="n">pros</span><span class="o">::</span><span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="linenos">35</span>    <span class="p">}</span>
<span class="linenos">36</span><span class="p">}</span>
</pre></div>
</div>
<p>More information regarding the HolonomicLib API can be found <a class="reference external" href="https://yessir120.github.io/HolonomicLib/index.html">here</a></p>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="AutonTranslate.html" class="btn btn-neutral float-right" title="Autonomous Translation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="Setup.html" class="btn btn-neutral float-left" title="Setting Things Up" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, 4253B Raid Zero.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>